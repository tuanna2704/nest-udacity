# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  lint:
    docker:
      - image: circleci/node:13.8.0
    steps:
      - checkout
      - restore_cache:
          keys: [dependencies]
      - run:
          name: Lint
          command: |
             npm run lint

  build-and-push-docker-image:
    docker:
      - image: docker:17.05.0-ce-git
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Build application Docker image
          command: |
            sudo docker build --no-cache -t tuanna2704/nest-udacity::${CIRCLE_SHA1} --tag=nest-example .
            docker login -u $DOCKER_LOGIN -p $DOCKER_PASSWORD
            docker push tuanna2704/nest-udacity::${CIRCLE_SHA1}

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  default:
    jobs:
      - lint:
          requires: [master]
      - build-and-push-docker-image:
          requires: [lint]
